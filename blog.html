<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blog Aravis Parapente</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: auto; padding: 20px; background: #f4f4f4; }
    form, .post { background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, textarea { width: 100%; margin-bottom: 10px; padding: 8px; font-size: 1rem; }
    img { max-width: 100%; margin-top: 10px; border-radius: 5px; }
    button { background: #005a9c; color: white; border: none; padding: 10px 15px; font-size: 1rem; border-radius: 5px; cursor: pointer; }
    button:hover { background: #004080; }
    h2 { margin: 0 0 10px 0; color: #005a9c; }
    time { font-size: 0.9rem; color: #666; }
  </style>
</head>
<body>

<h1>ðŸ“¸ Blog Aravis Parapente</h1>

<form id="postForm">
  <input type="text" id="titre" placeholder="Titre" required>
  <textarea id="commentaire" placeholder="Commentaire..." required></textarea>
  <input type="file" id="photo" accept="image/*" required>
  <input type="password" id="code" placeholder="Code secret" required>
  <button type="submit">Publier</button>
</form>

<section id="posts"></section>

<script>
function afficherArticles(articles) {
  const container = document.getElementById('posts');
  container.innerHTML = '';
  articles.reverse().forEach(article => {
    const el = document.createElement('div');
    el.className = 'post';
    el.innerHTML = `
      <h2>${article.titre}</h2>
      <time>${article.date}</time>
      <p>${article.commentaire}</p>
      <img src="${article.image}" alt="photo">
    `;
    container.appendChild(el);
  });
}

fetch('articles.json')
  .then(res => res.json())
  .then(data => afficherArticles(data));

document.getElementById('postForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const titre = document.getElementById('titre').value.trim();
  const commentaire = document.getElementById('commentaire').value.trim();
  const fichier = document.getElementById('photo').files[0];
  const code = document.getElementById('code').value.trim();

  if (!titre || !commentaire || !fichier || !code) return;

  const reader = new FileReader();
  reader.onload = function(event) {
    const imageData = event.target.result;
    const formData = new FormData();
    formData.append('titre', titre);
    formData.append('commentaire', commentaire);
    formData.append('image', imageData);
    formData.append('code', code);

    fetch('enregistrer.php', {
      method: 'POST',
      body: formData
    })
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        afficherArticles(data.articles);
        document.getElementById('postForm').reset();
      } else {
        alert("â›” " + data.message);
      }
    });
  };

  reader.readAsDataURL(fichier);
});
</script>

</body>
</html>
